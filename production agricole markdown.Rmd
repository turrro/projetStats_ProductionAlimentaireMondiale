---
title: "Production agricole mondiale"
author: "Ewen Lecoeur, Alice Sartre, Arthur Payen"
date: "2023-11-23"
output: html_document
---

bonjour c'ets oam

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Projet de Statistiques : Production agricole mondiale

# Sources :

<http://www.fao.org/home/en/> <https://data.worldbank.org/> <https://www.kaggle.com/datasets/patelris/crop-yield-prediction-dataset>, Richi Patel, [*Crop Yield Prediction Dataset (2021)*]{.underline}

# Préparation des données et packages

```{r packages, message=FALSE, warning=FALSE}
rm(list=ls())
library(knitr)
library(ggplot2)
library(cowplot)
library(FactoMineR)
library(factoextra)
library(corrplot)
library(ppcor)
library(emmeans)
library(car)
library(plyr)
library(gridExtra)
```

```{r data}
agri = read.table("Yield.csv", sep= ' ', row.names=1)
head(agri)
agripays = read.table("Yieldbycountry.csv", sep = ' ', row.names=1)
head(agripays)
```

# Questions à se poser :

-   Décrire le jeu de données (stats descriptives) → voir des éventuelles corrélations entre des variables ? → graphes de corrélation (correlation plot)

-   ACP pour sortir des classes de pays ou des classes de productions (par rendement, ou par climat = couple précipitations/température, ou par production principale)

-   ACP pour le rendement (pour voir quel facteur influence le plus cette variable)

-   essayer d'expliquer les rendements des différentes années par des facteurs (précipitations, températures, intrants) → évolution annuelle des rendements à comparer avec les évolutions annuelles des facteurs de production ? quel facteur de production est le plus important ? étude à l'échelle de chaque pays ? ou bien à l'échelle mondiale ?

-   rendement mondial = f(année) → pour chaque production ?

-   rendement/pays = f(température, pluie)

-   rendement/pays = f(pesticides)

-   quantité de pesticides = f(pays)

-   question du changement climatique : regarder des relations en lien avec la température (rendement par exemple) et prendre différents scénarios (+1°C, +2°C, ...)

# Un peu de statistiques descriptives...

```{r description}
sommaire = summary(agri)
kable(sommaire)
str(agri)
```

Dans cette partie, nous allons essayer d'observer de éventuels liens entre les rendements agricoles des pays et les facteurs qui les caractérisent.

On peut déjà dans un premier temps étudier une éventuelle corrélation entre les différentes variables avec un graphique de corrélation :

```{r correlation, graph=T}
correlation = cor(agri[,c(3:dim(agri)[2])])
kable(correlation,digits=2)
corrplot(correlation)
```

On ne peut pas distinguer de corrélation forte entre les différentes variables de notre jeu de données, peut-être qu'il faudrait affiner un peu notre recherche.

# ... Puis une analyse plus en profondeur

On peut commencer par une analyse des facteurs de production des facteurs abiotiques (précipitations et températures) sur lesquels on ne peut pas jouer par exemple :

```{r analyse 1}
ggplot(agri[agri$Item=="Potatoes",], aes(x=temp, y=yield)) + theme_bw() + geom_point(aes(y=yield,color=rain))
```

```{r analyse 2}
#ggplot(agri, aes(y=yield, x=Area)) + theme_bw() + geom_bar()
```

De plus, dans notre jeu de données, on ne dispose que de la quantité de pesticides totale pour chaque année et par pays. On peut donc se demander s'il n'y a pas des cultures qui réagissent mieux à l'utilisation de pesticides que d'autres, ce qui est une question possiblement intéressante à se poser pour les pays afin d'orienter leur politique agricole.

Tout d'abord, on peut commencer par un graphique représentant le rendement en fonction de l'utilisation de pesticides, pour essayer de dégager des groupes de cultures qui réagissent éventuellement mieux à l'utilisation de pesticides.

```{r comptage}
#comptage des cultures :
table(agri$Item)
```

Ainsi on peut voir que certaines cultures sont sur-représentées dans la production agricole et que d'autres sont sous-représentées. La variabilité sera peut-être plus grande pour les cultures sous-représentées, qui ont donc une taille d'échantillon moins grande.

```{r efficience pesticides}
ggplot(agri, aes(y=yield, x=pest, color=Item)) + geom_point() + theme_bw()
```

On peut réaliser une Analyse en Composantes Principales pour voir s'il n'y a pas des liens entre les variables quantitatives :

```{r test}
# j'ai testé un truc mais c'est pas encore fonctionnel là...
agrifrance = agripays[agripays$Area == "France", ]
agrifrance2 = agrifrance[,c("Year", "Maize")]
ggplot(agrifrance2,aes(y=Maize, x=Year)) + geom_point() + theme_bw() + ggtitle("Rendements du maïs selon l'année en France")
```

```{r ACP france 1}
# j'ai testé un truc mais c'est pas encore fonctionnel là...
agrifrance = agripays[agripays$Area == "France", ]
colnames(agrifrance)[c(8,13,14)] = c("Rice, paddy","Sweet potatoes","Plantains and others")
agrifrance2 = agrifrance[,c("Year","average_rain_fall_mm_per_year","pesticides_tonnes","avg_temp","Maize","Potatoes","Rice, paddy","Sorghum","Soybeans","Wheat")]
#agrifrance2 = agrifrance[,c("Year","average_rain_fall_mm_per_year","pesticides_tonnes","avg_temp")]
agrifrance2

#colnames(agrifrance) = c("Area","Year","average rain fall","pesticides","average temperature","Maize","Potatoes","Rice, paddy","Sorghum","Soybeans","Wheat","Cassava","Sweet potatoes","Plantains and others","Yams")
res.pca = PCA(agrifrance2, scale.unit = TRUE, graph = FALSE, ncp=5)
get_eigenvalue(res.pca)
fviz_eig(res.pca, addlabels = TRUE, ylim = c(0,50))
```

Concernant l'ACP que l'on vient de faire, il est clair qu'on n'atteint pas les 90% d'inertie espérés, mais on voit une rupture de pente sur le dernier graphe quand on passe à 3 dimensions. Sur le premier plan, on ne conserve que 56% de l'inertie totale, et pour atteindre 90% il nous faut 5 dimensions.

```{r ACP2}
p1 =fviz_pca_var(res.pca, axes = 1:2)
p2 =fviz_pca_var(res.pca, axes = 3:4)
#grid.arrange(p1,p2, nrow=1)
plot(p1)
plot(p2)
```

Sur le premier plan de l'ACP, on peut voir plusieurs variables qui sont corrélées : Les rendements du sorgho sont corrélés positivement à la température moyenne. En effet, le sorgho est une plante qui ressemble un peu au maïs mais qui est plus rustique et résiste mieux au stress hydrique. Or avec des températures croissantes, les périodes de stress hydrique et leur intensité augmentent. Ainsi le sorgho parvient à maintenir de bons niveaux de rendements. On peut donc bien comprendre la corrélation entre les températures et ses rendements. Par ailleurs, d'autres céréales comme le blé, le soja et le maïs sont elles corrélées aux précipitations annuelles. On peut penser que c'est justement car, au contraire du sorgho, ces cultures n'ont pas de résistance particulière aux stress hydriques, en revanche elles ont un très bonne efficience à l'eau, et particulièrement le maïs : pour une même quantité d'eau apportée à une culture, c'est chez le maïs qu'on observe la plus grande production de biomasse. On observe également une légère corrélation négative entre l'utilisation de pesticides en tonnes et l'année. Cela montre donc qu'il y a peut-être une réduction de l'usage de pesticides au fil des années. Cependant, cette anticorrélation reste peu flagrante.

"Ceci est un test de commit : 'Hello World!'" "Ceci est encore un test de commit : 'Hello World!'" "Ceci est encore un test de commit : 'Hello World!33'"
